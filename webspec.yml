version: 0.2

phases:
  install:
    runtime-versions:
      docker: 18
      dotnet: 2.2
      python: 3.7
      ruby: 2.6
  pre_build:
    commands:
      - COMMIT_HASH=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)
      - IMAGE_TAG=${COMMIT_HASH:=latest}
      - echo Initializing Git Repo
      - git init
      - git remote add origin https://github.com/jamesbland123/modernization-devsecops-workshop.git
      - git fetch
      - git checkout -f "$CODEBUILD_RESOLVED_SOURCE_VERSION"
      - git submodule init
      - git submodule update --recursive  

  build:
    commands:
      - echo "hello world"
   
  post_build:
    commands:
      - echo Build completed on `date`
      
